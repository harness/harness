image: library/golang:1.4.2
git:
  path: github.com/drone/drone
script:
  - export GOPATH=/var/cache/drone
  - export PATH=$PATH:$GOPATH/bin
  - go get golang.org/x/tools/cmd/vet
  - go get -u github.com/jteeuwen/go-bindata/...
  - make bindata deps
  - make build
  - make test
  - make dist

notify:
  email:
    recipients:
      - brad@drone.io

publish:
  s3:
    acl: public-read
    region: us-east-1
    bucket: downloads.drone.io
    access_key: $$AWS_KEY
    secret_key: $$AWS_SECRET
    source: dist/drone.deb
    target: $DRONE_BRANCH/
    when:
      owner: drone

# new .drone.yml syntax

clone:
  path: github.com/drone/drone

build:
  image: golang:1.4.2
  commands:
    - export GOPATH=/drone
    - export PATH=$PATH:$GOPATH/bin
    - go get -u github.com/jteeuwen/go-bindata/...
    - make bindata deps
    - make build
    - make test
